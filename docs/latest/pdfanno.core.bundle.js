(function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports.PDFAnnoCore=t():e.PDFAnnoCore=t()})(this,function(){var e=Math.min,t=Math.abs,n=Math.sin,o=Math.cos,r=Math.atan,a=Math.floor;return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=70)}([,function(e,t){'use strict';function n(){let e=window.PDFView||window.iframeWindow.PDFView,t=e.pdfViewer.getPageView(0).viewport.viewBox,n={width:t[2],height:t[3]};return n}t.b=function(e){let t=n();e-=o;let i=t.height+r,s=a(e/i)+1,l=e-(s-1)*i;return{pageNumber:s,y:l}},t.a=function(e,t){let i=n(),a=t+o;return a+=(e-1)*(i.height+r),a},t.c=function(){let e=window.iframeWindow?window.iframeWindow:window;return e.nextZIndex||(e.nextZIndex=10),e.nextZIndex++};const o=9,r=9;t.d=r},,function(e,t){'use strict';t.a=function(e,t){return 0<t.filter((t)=>t===e).length},t.b=function(e,t){var n=document.createEvent('CustomEvent');n.initCustomEvent(e,!0,!0,t),window.dispatchEvent(n)},t.c=function(){return window.location.search.replace('?','').split('&').reduce((e,t)=>{const[n,o]=t.split('=');return e[n]=o,e},{})}},function(e,t){'use strict';t.a=function(e=8){const t='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',n=t.length;let o='';for(let r=0;r<e;r++)o+=t[a(Math.random()*n)];return o}},function(e){e.exports=function(){var e=[];return e.toString=function(){for(var e,t=[],n=0;n<this.length;n++)e=this[n],e[2]?t.push('@media '+e[2]+'{'+e[1]+'}'):t.push(e[1]);return t.join('')},e.i=function(t,n){'string'==typeof t&&(t=[[null,t,'']]);for(var o,r={},a=0;a<this.length;a++)o=this[a][0],'number'==typeof o&&(r[o]=!0);for(a=0;a<t.length;a++){var i=t[a];'number'==typeof i[0]&&r[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]='('+i[2]+') and ('+n+')'),e.push(i))}},e}},function(e){function t(e,t){for(var n=0;n<e.length;n++){var o=e[n],r=u[o.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](o.parts[i]);for(;i<o.parts.length;i++)r.parts.push(s(o.parts[i],t))}else{for(var a=[],i=0;i<o.parts.length;i++)a.push(s(o.parts[i],t));u[o.id]={id:o.id,refs:1,parts:a}}}}function n(e){for(var t=[],n={},o=0;o<e.length;o++){var r=e[o],i=r[0],a=r[1],s=r[2],l=r[3],d={css:a,media:s,sourceMap:l};n[i]?n[i].parts.push(d):t.push(n[i]={id:i,parts:[d]})}return t}function o(e,t){var n=y(),o=x[x.length-1];if('top'===e.insertAt)o?o.nextSibling?n.insertBefore(t,o.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),x.push(t);else if('bottom'===e.insertAt)n.appendChild(t);else throw new Error('Invalid value for parameter \'insertAt\'. Must be \'top\' or \'bottom\'.')}function r(e){e.parentNode.removeChild(e);var t=x.indexOf(e);0<=t&&x.splice(t,1)}function i(e){var t=document.createElement('style');return t.type='text/css',o(e,t),t}function a(e){var t=document.createElement('link');return t.rel='stylesheet',o(e,t),t}function s(e,t){var n,o,s;if(t.singleton){var u=g++;n=v||(v=i(t)),o=l.bind(null,n,u,!1),s=l.bind(null,n,u,!0)}else e.sourceMap&&'function'==typeof URL&&'function'==typeof URL.createObjectURL&&'function'==typeof URL.revokeObjectURL&&'function'==typeof Blob&&'function'==typeof btoa?(n=a(t),o=p.bind(null,n),s=function(){r(n),n.href&&URL.revokeObjectURL(n.href)}):(n=i(t),o=d.bind(null,n),s=function(){r(n)});return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else s()}}function l(e,t,n,o){var r=n?'':o.css;if(e.styleSheet)e.styleSheet.cssText=f(t,r);else{var i=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function d(e,t){var n=t.css,o=t.media;if(o&&e.setAttribute('media',o),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function p(e,t){var n=t.css,o=t.sourceMap;o&&(n+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */');var r=new Blob([n],{type:'text/css'}),i=e.href;e.href=URL.createObjectURL(r),i&&URL.revokeObjectURL(i)}var u={},c=function(e){var t;return function(){return'undefined'==typeof t&&(t=e.apply(this,arguments)),t}},h=c(function(){return /msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),y=c(function(){return document.head||document.getElementsByTagName('head')[0]}),v=null,g=0,x=[];e.exports=function(e,o){if('undefined'!=typeof DEBUG&&DEBUG&&'object'!=typeof document)throw new Error('The style-loader cannot be used in a non-browser environment');o=o||{},'undefined'==typeof o.singleton&&(o.singleton=h()),'undefined'==typeof o.insertAt&&(o.insertAt='bottom');var r=n(e);return t(r,o),function(e){for(var a=[],s=0;s<r.length;s++){var i=r[s],l=u[i.id];l.refs--,a.push(l)}if(e){var d=n(e);t(d,o)}for(var l,s=0;s<a.length;s++)if(l=a[s],0===l.refs){for(var p=0;p<l.parts.length;p++)l.parts[p]();delete u[l.id]}}};var f=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join('\n')}}()},,,,,,function(e,t,n){var o=n(13),r=n(14);e.exports={parse:function(e){var t=o.parse(e.toString());return r.compile(t)}}},function(e){e.exports=function(){function e(e,t,n,o,r,i){this.message=e,this.expected=t,this.found=n,this.offset=o,this.line=r,this.column=i,this.name='SyntaxError'}function t(t){function n(){return r(Ln).line}function o(){return r(Ln).column}function r(e){return On!==e&&(On>e&&(On=0,Mn={line:1,column:1,seenCR:!1}),function(e,n,o){var r,i;for(r=n;r<o;r++)i=t.charAt(r),'\n'===i?(!e.seenCR&&e.line++,e.column=1,e.seenCR=!1):'\r'===i||'\u2028'===i||'\u2029'===i?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(Mn,On,e),On=e),Mn}function i(e){Rn<In||(Rn>In&&(In=Rn,Vn=[]),Vn.push(e))}function s(){var e,t,n,o=49*Rn+0,r=Sn[o];if(r)return Rn=r.nextPos,r.result;for(e=Rn,t=[],n=l();n!==ue;)t.push(n),n=l();return t!==ue&&(Ln=e,t=ye()),e=t,Sn[o]={nextPos:Rn,result:e},e}function l(){var e,t,n,o,r,i,a,s=49*Rn+1,l=Sn[s];if(l)return Rn=l.nextPos,l.result;for(e=Rn,t=[],n=Z();n!==ue;)t.push(n),n=Z();if(t===ue)Rn=e,e=ve;else if(n=d(),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();if(o!==ue){for(r=[],i=p();i!==ue;)r.push(i),i=p();if(r!==ue){if(i=[],a=W(),a!==ue)for(;a!==ue;)i.push(a),a=W();else i=ve;i===ue&&(i=G()),i===ue?(Rn=e,e=ve):(t=[t,n,o,r,i],e=t)}else Rn=e,e=ve}else Rn=e,e=ve}else Rn=e,e=ve;if(e===ue){if(e=Rn,t=[],n=Z(),n!==ue)for(;n!==ue;)t.push(n),n=Z();else t=ve;if(t!==ue){if(n=[],o=W(),o!==ue)for(;o!==ue;)n.push(o),o=W();else n=ve;n===ue&&(n=G()),n===ue?(Rn=e,e=ve):(t=[t,n],e=t)}else Rn=e,e=ve;e===ue&&(e=W())}return Sn[s]={nextPos:Rn,result:e},e}function d(){var e,t=49*Rn+2,n=Sn[t];return n?(Rn=n.nextPos,n.result):(e=p(),e===ue&&(e=u(),e===ue&&(e=c(),e===ue&&(e=g()))),Sn[t]={nextPos:Rn,result:e},e)}function p(){var e,n,o,r,a,s,l=49*Rn+3,d=Sn[l];if(d)return Rn=d.nextPos,d.result;if(e=Rn,35===t.charCodeAt(Rn)?(n=ge,Rn++):(n=ue,0===Tn&&i(xe)),n!==ue){for(o=[],r=Rn,a=Rn,Tn++,s=W(),s===ue&&(s=G()),Tn--,s===ue?a=le:(Rn=a,a=ve),a===ue?(Rn=r,r=ve):(t.length>Rn?(s=t.charAt(Rn),Rn++):(s=ue,0===Tn&&i(fe)),s===ue?(Rn=r,r=ve):(a=[a,s],r=a));r!==ue;)o.push(r),r=Rn,a=Rn,Tn++,s=W(),s===ue&&(s=G()),Tn--,s===ue?a=le:(Rn=a,a=ve),a===ue?(Rn=r,r=ve):(t.length>Rn?(s=t.charAt(Rn),Rn++):(s=ue,0===Tn&&i(fe)),s===ue?(Rn=r,r=ve):(a=[a,s],r=a));o===ue?(Rn=e,e=ve):(n=[n,o],e=n)}else Rn=e,e=ve;return Sn[l]={nextPos:Rn,result:e},e}function u(){var e,n,o,r,a,s,l=49*Rn+4,d=Sn[l];if(d)return Rn=d.nextPos,d.result;if(e=Rn,91===t.charCodeAt(Rn)?(n=be,Rn++):(n=ue,0===Tn&&i(me)),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();if(o===ue)Rn=e,e=ve;else if(r=h(),r!==ue){for(a=[],s=Z();s!==ue;)a.push(s),s=Z();a===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(s=Ae,Rn++):(s=ue,0===Tn&&i(ke)),s===ue?(Rn=e,e=ve):(Ln=e,n=we(r),e=n))}else Rn=e,e=ve}else Rn=e,e=ve;return Sn[l]={nextPos:Rn,result:e},e}function c(){var e,n,o,r,a,s,l,d,p=49*Rn+5,u=Sn[p];if(u)return Rn=u.nextPos,u.result;if(e=Rn,91===t.charCodeAt(Rn)?(n=be,Rn++):(n=ue,0===Tn&&i(me)),n===ue)Rn=e,e=ve;else if(91===t.charCodeAt(Rn)?(o=be,Rn++):(o=ue,0===Tn&&i(me)),o!==ue){for(r=[],a=Z();a!==ue;)r.push(a),a=Z();if(r===ue)Rn=e,e=ve;else if(a=h(),a!==ue){for(s=[],l=Z();l!==ue;)s.push(l),l=Z();s===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(l=Ae,Rn++):(l=ue,0===Tn&&i(ke)),l===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(d=Ae,Rn++):(d=ue,0===Tn&&i(ke)),d===ue?(Rn=e,e=ve):(Ln=e,n=Ce(a),e=n)))}else Rn=e,e=ve}else Rn=e,e=ve;return Sn[p]={nextPos:Rn,result:e},e}function h(){var e,t,n,o=49*Rn+6,r=Sn[o];if(r)return Rn=r.nextPos,r.result;if(e=Rn,t=[],n=v(),n!==ue)for(;n!==ue;)t.push(n),n=v();else t=ve;return t===ue?(Rn=e,e=ve):(n=y(),n===ue?(Rn=e,e=ve):(Ln=e,t=Ee(t,n),e=t)),e===ue&&(e=Rn,t=y(),t!==ue&&(Ln=e,t=_e(t)),e=t),Sn[o]={nextPos:Rn,result:e},e}function y(){var e,t,n,o,r,i=49*Rn+7,a=Sn[i];if(a)return Rn=a.nextPos,a.result;for(e=Rn,t=[],n=Z();n!==ue;)t.push(n),n=Z();if(t===ue)Rn=e,e=ve;else if(n=x(),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();o===ue?(Rn=e,e=ve):(Ln=e,t=Pe(n),e=t)}else Rn=e,e=ve;if(e===ue){for(e=Rn,t=[],n=Z();n!==ue;)t.push(n),n=Z();if(t===ue)Rn=e,e=ve;else if(n=f(),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();o===ue?(Rn=e,e=ve):(Ln=e,t=Pe(n),e=t)}else Rn=e,e=ve}return Sn[i]={nextPos:Rn,result:e},e}function v(){var e,n,o,r,a,s,l,d=49*Rn+8,p=Sn[d];if(p)return Rn=p.nextPos,p.result;for(e=Rn,n=[],o=Z();o!==ue;)n.push(o),o=Z();if(n===ue)Rn=e,e=ve;else if(o=x(),o!==ue){for(r=[],a=Z();a!==ue;)r.push(a),a=Z();if(r===ue)Rn=e,e=ve;else if(46===t.charCodeAt(Rn)?(a=Re,Rn++):(a=ue,0===Tn&&i(Le)),a!==ue){for(s=[],l=Z();l!==ue;)s.push(l),l=Z();s===ue?(Rn=e,e=ve):(Ln=e,n=Pe(o),e=n)}else Rn=e,e=ve}else Rn=e,e=ve;if(e===ue){for(e=Rn,n=[],o=Z();o!==ue;)n.push(o),o=Z();if(n===ue)Rn=e,e=ve;else if(o=f(),o!==ue){for(r=[],a=Z();a!==ue;)r.push(a),a=Z();if(r===ue)Rn=e,e=ve;else if(46===t.charCodeAt(Rn)?(a=Re,Rn++):(a=ue,0===Tn&&i(Le)),a!==ue){for(s=[],l=Z();l!==ue;)s.push(l),l=Z();s===ue?(Rn=e,e=ve):(Ln=e,n=Pe(o),e=n)}else Rn=e,e=ve}else Rn=e,e=ve}return Sn[d]={nextPos:Rn,result:e},e}function g(){var e,n,o,r,a,s,l=49*Rn+9,d=Sn[l];if(d)return Rn=d.nextPos,d.result;if(e=Rn,n=x(),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();if(o===ue)Rn=e,e=ve;else if(61===t.charCodeAt(Rn)?(r=Oe,Rn++):(r=ue,0===Tn&&i(Me)),r!==ue){for(a=[],s=Z();s!==ue;)a.push(s),s=Z();a===ue?(Rn=e,e=ve):(s=b(),s===ue?(Rn=e,e=ve):(Ln=e,n=Ie(n,s),e=n))}else Rn=e,e=ve}else Rn=e,e=ve;if(e===ue)if(e=Rn,n=f(),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();if(o===ue)Rn=e,e=ve;else if(61===t.charCodeAt(Rn)?(r=Oe,Rn++):(r=ue,0===Tn&&i(Me)),r!==ue){for(a=[],s=Z();s!==ue;)a.push(s),s=Z();a===ue?(Rn=e,e=ve):(s=b(),s===ue?(Rn=e,e=ve):(Ln=e,n=Ie(n,s),e=n))}else Rn=e,e=ve}else Rn=e,e=ve;return Sn[l]={nextPos:Rn,result:e},e}function x(){var e,t,n,o=49*Rn+10,r=Sn[o];if(r)return Rn=r.nextPos,r.result;if(e=Rn,t=[],n=J(),n!==ue)for(;n!==ue;)t.push(n),n=J();else t=ve;return t!==ue&&(Ln=e,t=Ve(t)),e=t,Sn[o]={nextPos:Rn,result:e},e}function f(){var e,t,n=49*Rn+11,o=Sn[n];return o?(Rn=o.nextPos,o.result):(e=Rn,t=k(),t!==ue&&(Ln=e,t=Te(t)),e=t,e===ue&&(e=Rn,t=C(),t!==ue&&(Ln=e,t=Te(t)),e=t),Sn[n]={nextPos:Rn,result:e},e)}function b(){var e,t=49*Rn+12,n=Sn[t];return n?(Rn=n.nextPos,n.result):(e=m(),e===ue&&(e=Y(),e===ue&&(e=O(),e===ue&&(e=I(),e===ue&&(e=T(),e===ue&&(e=S(),e===ue&&(e=F())))))),Sn[t]={nextPos:Rn,result:e},e)}function m(){var e,t=49*Rn+13,n=Sn[t];return n?(Rn=n.nextPos,n.result):(e=A(),e===ue&&(e=k(),e===ue&&(e=w(),e===ue&&(e=C()))),Sn[t]={nextPos:Rn,result:e},e)}function A(){var e,n,o,r,a,s=49*Rn+14,l=Sn[s];if(l)return Rn=l.nextPos,l.result;if(e=Rn,t.substr(Rn,3)===Se?(n=Se,Rn+=3):(n=ue,0===Tn&&i(De)),n===ue)Rn=e,e=ve;else if(o=W(),o===ue&&(o=je),o!==ue){for(r=[],a=P();a!==ue;)r.push(a),a=P();r===ue?(Rn=e,e=ve):(t.substr(Rn,3)===Se?(a=Se,Rn+=3):(a=ue,0===Tn&&i(De)),a===ue?(Rn=e,e=ve):(Ln=e,n=Ne(r),e=n))}else Rn=e,e=ve;return Sn[s]={nextPos:Rn,result:e},e}function k(){var e,n,o,r,a=49*Rn+15,s=Sn[a];if(s)return Rn=s.nextPos,s.result;if(e=Rn,34===t.charCodeAt(Rn)?(n=Fe,Rn++):(n=ue,0===Tn&&i(He)),n!==ue){for(o=[],r=E();r!==ue;)o.push(r),r=E();o===ue?(Rn=e,e=ve):(34===t.charCodeAt(Rn)?(r=Fe,Rn++):(r=ue,0===Tn&&i(He)),r===ue?(Rn=e,e=ve):(Ln=e,n=Ne(o),e=n))}else Rn=e,e=ve;return Sn[a]={nextPos:Rn,result:e},e}function w(){var e,n,o,r,a,s=49*Rn+16,l=Sn[s];if(l)return Rn=l.nextPos,l.result;if(e=Rn,t.substr(Rn,3)===$e?(n=$e,Rn+=3):(n=ue,0===Tn&&i(Ue)),n===ue)Rn=e,e=ve;else if(o=W(),o===ue&&(o=je),o!==ue){for(r=[],a=L();a!==ue;)r.push(a),a=L();r===ue?(Rn=e,e=ve):(t.substr(Rn,3)===$e?(a=$e,Rn+=3):(a=ue,0===Tn&&i(Ue)),a===ue?(Rn=e,e=ve):(Ln=e,n=Ne(r),e=n))}else Rn=e,e=ve;return Sn[s]={nextPos:Rn,result:e},e}function C(){var e,n,o,r,a=49*Rn+17,s=Sn[a];if(s)return Rn=s.nextPos,s.result;if(e=Rn,39===t.charCodeAt(Rn)?(n=Be,Rn++):(n=ue,0===Tn&&i(ze)),n!==ue){for(o=[],r=_();r!==ue;)o.push(r),r=_();o===ue?(Rn=e,e=ve):(39===t.charCodeAt(Rn)?(r=Be,Rn++):(r=ue,0===Tn&&i(ze)),r===ue?(Rn=e,e=ve):(Ln=e,n=Ne(o),e=n))}else Rn=e,e=ve;return Sn[a]={nextPos:Rn,result:e},e}function E(){var e,n,o,r=49*Rn+18,a=Sn[r];return a?(Rn=a.nextPos,a.result):(e=te(),e===ue&&(e=Rn,n=Rn,Tn++,34===t.charCodeAt(Rn)?(o=Fe,Rn++):(o=ue,0===Tn&&i(He)),Tn--,o===ue?n=le:(Rn=n,n=ve),n===ue?(Rn=e,e=ve):(t.length>Rn?(o=t.charAt(Rn),Rn++):(o=ue,0===Tn&&i(fe)),o===ue?(Rn=e,e=ve):(Ln=e,n=Xe(o),e=n))),Sn[r]={nextPos:Rn,result:e},e)}function _(){var e,n,o,r=49*Rn+19,a=Sn[r];return a?(Rn=a.nextPos,a.result):(e=Rn,n=Rn,Tn++,39===t.charCodeAt(Rn)?(o=Be,Rn++):(o=ue,0===Tn&&i(ze)),Tn--,o===ue?n=le:(Rn=n,n=ve),n===ue?(Rn=e,e=ve):(t.length>Rn?(o=t.charAt(Rn),Rn++):(o=ue,0===Tn&&i(fe)),o===ue?(Rn=e,e=ve):(Ln=e,n=Xe(o),e=n)),Sn[r]={nextPos:Rn,result:e},e)}function P(){var e,n,o,r=49*Rn+20,a=Sn[r];return a?(Rn=a.nextPos,a.result):(e=te(),e===ue&&(e=R(),e===ue&&(e=Rn,n=Rn,Tn++,t.substr(Rn,3)===Se?(o=Se,Rn+=3):(o=ue,0===Tn&&i(De)),Tn--,o===ue?n=le:(Rn=n,n=ve),n===ue?(Rn=e,e=ve):(t.length>Rn?(o=t.charAt(Rn),Rn++):(o=ue,0===Tn&&i(fe)),o===ue?(Rn=e,e=ve):(Ln=e,n=Ye(o),e=n)))),Sn[r]={nextPos:Rn,result:e},e)}function R(){var e,n,o,r,a,s=49*Rn+21,l=Sn[s];if(l)return Rn=l.nextPos,l.result;if(e=Rn,92===t.charCodeAt(Rn)?(n=Ze,Rn++):(n=ue,0===Tn&&i(We)),n===ue)Rn=e,e=ve;else if(o=W(),o!==ue){for(r=[],a=q();a!==ue;)r.push(a),a=q();r===ue?(Rn=e,e=ve):(Ln=e,n=qe(),e=n)}else Rn=e,e=ve;return Sn[s]={nextPos:Rn,result:e},e}function L(){var e,n,o,r=49*Rn+22,a=Sn[r];return a?(Rn=a.nextPos,a.result):(e=Rn,n=Rn,Tn++,t.substr(Rn,3)===$e?(o=$e,Rn+=3):(o=ue,0===Tn&&i(Ue)),Tn--,o===ue?n=le:(Rn=n,n=ve),n===ue?(Rn=e,e=ve):(t.length>Rn?(o=t.charAt(Rn),Rn++):(o=ue,0===Tn&&i(fe)),o===ue?(Rn=e,e=ve):(Ln=e,n=Xe(o),e=n)),Sn[r]={nextPos:Rn,result:e},e)}function O(){var e,n,o,r,a=49*Rn+23,s=Sn[a];return s?(Rn=s.nextPos,s.result):(e=Rn,n=M(),n===ue&&(n=V()),n===ue?(Rn=e,e=ve):(101===t.charCodeAt(Rn)?(o=Ge,Rn++):(o=ue,0===Tn&&i(Ke)),o===ue&&(69===t.charCodeAt(Rn)?(o=Qe,Rn++):(o=ue,0===Tn&&i(Je))),o===ue?(Rn=e,e=ve):(r=V(),r===ue?(Rn=e,e=ve):(Ln=e,n=et(n,r),e=n))),e===ue&&(e=Rn,n=M(),n!==ue&&(Ln=e,n=tt(n)),e=n),Sn[a]={nextPos:Rn,result:e},e)}function M(){var e,n,o,r,a,s,l=49*Rn+24,d=Sn[l];return d?(Rn=d.nextPos,d.result):(e=Rn,43===t.charCodeAt(Rn)?(n=nt,Rn++):(n=ue,0===Tn&&i(ot)),n===ue&&(n=je),n===ue?(Rn=e,e=ve):(o=Rn,r=ee(),r===ue?(Rn=o,o=ve):(46===t.charCodeAt(Rn)?(a=Re,Rn++):(a=ue,0===Tn&&i(Le)),a===ue?(Rn=o,o=ve):(s=ee(),s===ue?(Rn=o,o=ve):(r=[r,a,s],o=r))),o===ue?(Rn=e,e=ve):(Ln=e,n=rt(o),e=n)),e===ue&&(e=Rn,45===t.charCodeAt(Rn)?(n=it,Rn++):(n=ue,0===Tn&&i(at)),n===ue?(Rn=e,e=ve):(o=Rn,r=ee(),r===ue?(Rn=o,o=ve):(46===t.charCodeAt(Rn)?(a=Re,Rn++):(a=ue,0===Tn&&i(Le)),a===ue?(Rn=o,o=ve):(s=ee(),s===ue?(Rn=o,o=ve):(r=[r,a,s],o=r))),o===ue?(Rn=e,e=ve):(Ln=e,n=st(o),e=n))),Sn[l]={nextPos:Rn,result:e},e)}function I(){var e,t,n=49*Rn+25,o=Sn[n];return o?(Rn=o.nextPos,o.result):(e=Rn,t=V(),t!==ue&&(Ln=e,t=lt(t)),e=t,Sn[n]={nextPos:Rn,result:e},e)}function V(){var e,n,o,r,a,s=49*Rn+26,l=Sn[s];if(l)return Rn=l.nextPos,l.result;if(e=Rn,43===t.charCodeAt(Rn)?(n=nt,Rn++):(n=ue,0===Tn&&i(ot)),n===ue&&(n=je),n!==ue){if(o=[],r=Q(),r!==ue)for(;r!==ue;)o.push(r),r=Q();else o=ve;o===ue?(Rn=e,e=ve):(r=Rn,Tn++,46===t.charCodeAt(Rn)?(a=Re,Rn++):(a=ue,0===Tn&&i(Le)),Tn--,a===ue?r=le:(Rn=r,r=ve),r===ue?(Rn=e,e=ve):(Ln=e,n=rt(o),e=n))}else Rn=e,e=ve;if(e===ue)if(e=Rn,45===t.charCodeAt(Rn)?(n=it,Rn++):(n=ue,0===Tn&&i(at)),n!==ue){if(o=[],r=Q(),r!==ue)for(;r!==ue;)o.push(r),r=Q();else o=ve;o===ue?(Rn=e,e=ve):(r=Rn,Tn++,46===t.charCodeAt(Rn)?(a=Re,Rn++):(a=ue,0===Tn&&i(Le)),Tn--,a===ue?r=le:(Rn=r,r=ve),r===ue?(Rn=e,e=ve):(Ln=e,n=st(o),e=n))}else Rn=e,e=ve;return Sn[s]={nextPos:Rn,result:e},e}function T(){var e,n,o=49*Rn+27,r=Sn[o];return r?(Rn=r.nextPos,r.result):(e=Rn,t.substr(Rn,4)===dt?(n=dt,Rn+=4):(n=ue,0===Tn&&i(pt)),n!==ue&&(Ln=e,n=ut()),e=n,e===ue&&(e=Rn,t.substr(Rn,5)===ct?(n=ct,Rn+=5):(n=ue,0===Tn&&i(ht)),n!==ue&&(Ln=e,n=yt()),e=n),Sn[o]={nextPos:Rn,result:e},e)}function S(){var e,n,o,r,a,s=49*Rn+28,l=Sn[s];if(l)return Rn=l.nextPos,l.result;if(e=Rn,91===t.charCodeAt(Rn)?(n=be,Rn++):(n=ue,0===Tn&&i(me)),n!==ue){for(o=[],r=N();r!==ue;)o.push(r),r=N();o===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(r=Ae,Rn++):(r=ue,0===Tn&&i(ke)),r===ue?(Rn=e,e=ve):(Ln=e,n=vt(),e=n))}else Rn=e,e=ve;if(e===ue&&(e=Rn,91===t.charCodeAt(Rn)?(n=be,Rn++):(n=ue,0===Tn&&i(me)),n===ue?(Rn=e,e=ve):(o=D(),o===ue&&(o=je),o===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(r=Ae,Rn++):(r=ue,0===Tn&&i(ke)),r===ue?(Rn=e,e=ve):(Ln=e,n=gt(o),e=n))),e===ue)){if(e=Rn,91===t.charCodeAt(Rn)?(n=be,Rn++):(n=ue,0===Tn&&i(me)),n!==ue){if(o=[],r=j(),r!==ue)for(;r!==ue;)o.push(r),r=j();else o=ve;o===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(r=Ae,Rn++):(r=ue,0===Tn&&i(ke)),r===ue?(Rn=e,e=ve):(Ln=e,n=xt(o),e=n))}else Rn=e,e=ve;if(e===ue)if(e=Rn,91===t.charCodeAt(Rn)?(n=be,Rn++):(n=ue,0===Tn&&i(me)),n!==ue){if(o=[],r=j(),r!==ue)for(;r!==ue;)o.push(r),r=j();else o=ve;o===ue?(Rn=e,e=ve):(r=D(),r===ue?(Rn=e,e=ve):(93===t.charCodeAt(Rn)?(a=Ae,Rn++):(a=ue,0===Tn&&i(ke)),a===ue?(Rn=e,e=ve):(Ln=e,n=ft(o,r),e=n)))}else Rn=e,e=ve}return Sn[s]={nextPos:Rn,result:e},e}function D(){var e,t,n,o,r,i=49*Rn+29,a=Sn[i];if(a)return Rn=a.nextPos,a.result;for(e=Rn,t=[],n=N();n!==ue;)t.push(n),n=N();if(t===ue)Rn=e,e=ve;else if(n=b(),n!==ue){for(o=[],r=N();r!==ue;)o.push(r),r=N();o===ue?(Rn=e,e=ve):(Ln=e,t=bt(n),e=t)}else Rn=e,e=ve;return Sn[i]={nextPos:Rn,result:e},e}function j(){var e,n,o,r,a,s,l,d=49*Rn+30,p=Sn[d];if(p)return Rn=p.nextPos,p.result;for(e=Rn,n=[],o=N();o!==ue;)n.push(o),o=N();if(n===ue)Rn=e,e=ve;else if(o=b(),o!==ue){for(r=[],a=N();a!==ue;)r.push(a),a=N();if(r===ue)Rn=e,e=ve;else if(44===t.charCodeAt(Rn)?(a=mt,Rn++):(a=ue,0===Tn&&i(At)),a!==ue){for(s=[],l=N();l!==ue;)s.push(l),l=N();s===ue?(Rn=e,e=ve):(Ln=e,n=bt(o),e=n)}else Rn=e,e=ve}else Rn=e,e=ve;return Sn[d]={nextPos:Rn,result:e},e}function N(){var e,t=49*Rn+31,n=Sn[t];return n?(Rn=n.nextPos,n.result):(e=Z(),e===ue&&(e=W(),e===ue&&(e=p())),Sn[t]={nextPos:Rn,result:e},e)}function F(){var e,n,o,r,a,s,l=49*Rn+32,d=Sn[l];if(d)return Rn=d.nextPos,d.result;if(e=Rn,123===t.charCodeAt(Rn)?(n=kt,Rn++):(n=ue,0===Tn&&i(wt)),n!==ue){for(o=[],r=Z();r!==ue;)o.push(r),r=Z();if(o!==ue){for(r=[],a=H();a!==ue;)r.push(a),a=H();if(r!==ue){for(a=[],s=Z();s!==ue;)a.push(s),s=Z();a===ue?(Rn=e,e=ve):(125===t.charCodeAt(Rn)?(s=Ct,Rn++):(s=ue,0===Tn&&i(Et)),s===ue?(Rn=e,e=ve):(Ln=e,n=_t(r),e=n))}else Rn=e,e=ve}else Rn=e,e=ve}else Rn=e,e=ve;return Sn[l]={nextPos:Rn,result:e},e}function H(){var e,n,o,r,a,s,l,d,p,u,c,h=49*Rn+33,y=Sn[h];if(y)return Rn=y.nextPos,y.result;for(e=Rn,n=[],o=Z();o!==ue;)n.push(o),o=Z();if(n===ue)Rn=e,e=ve;else if(o=x(),o!==ue){for(r=[],a=Z();a!==ue;)r.push(a),a=Z();if(r===ue)Rn=e,e=ve;else if(61===t.charCodeAt(Rn)?(a=Oe,Rn++):(a=ue,0===Tn&&i(Me)),a!==ue){for(s=[],l=Z();l!==ue;)s.push(l),l=Z();if(s===ue)Rn=e,e=ve;else if(l=b(),l!==ue){for(d=[],p=Z();p!==ue;)d.push(p),p=Z();if(d===ue)Rn=e,e=ve;else if(44===t.charCodeAt(Rn)?(p=mt,Rn++):(p=ue,0===Tn&&i(At)),p!==ue){for(u=[],c=Z();c!==ue;)u.push(c),c=Z();u===ue?(Rn=e,e=ve):(Ln=e,n=Pt(o,l),e=n)}else Rn=e,e=ve}else Rn=e,e=ve}else Rn=e,e=ve}else Rn=e,e=ve;if(e===ue){for(e=Rn,n=[],o=Z();o!==ue;)n.push(o),o=Z();if(n===ue)Rn=e,e=ve;else if(o=x(),o!==ue){for(r=[],a=Z();a!==ue;)r.push(a),a=Z();if(r===ue)Rn=e,e=ve;else if(61===t.charCodeAt(Rn)?(a=Oe,Rn++):(a=ue,0===Tn&&i(Me)),a!==ue){for(s=[],l=Z();l!==ue;)s.push(l),l=Z();s===ue?(Rn=e,e=ve):(l=b(),l===ue?(Rn=e,e=ve):(Ln=e,n=Pt(o,l),e=n))}else Rn=e,e=ve}else Rn=e,e=ve}return Sn[h]={nextPos:Rn,result:e},e}function U(){var e,n,o,r=49*Rn+34,a=Sn[r];return a?(Rn=a.nextPos,a.result):(e=Rn,46===t.charCodeAt(Rn)?(n=Re,Rn++):(n=ue,0===Tn&&i(Le)),n===ue?(Rn=e,e=ve):(o=ee(),o===ue?(Rn=e,e=ve):(Ln=e,n=Rt(o),e=n)),Sn[r]={nextPos:Rn,result:e},e)}function B(){var e,n,o,r,a,s,l,d,p,u,c,h,y=49*Rn+35,v=Sn[y];return v?(Rn=v.nextPos,v.result):(e=Rn,n=Rn,o=Q(),o===ue?(Rn=n,n=ve):(r=Q(),r===ue?(Rn=n,n=ve):(a=Q(),a===ue?(Rn=n,n=ve):(s=Q(),s===ue?(Rn=n,n=ve):(45===t.charCodeAt(Rn)?(l=it,Rn++):(l=ue,0===Tn&&i(at)),l===ue?(Rn=n,n=ve):(d=Q(),d===ue?(Rn=n,n=ve):(p=Q(),p===ue?(Rn=n,n=ve):(45===t.charCodeAt(Rn)?(u=it,Rn++):(u=ue,0===Tn&&i(at)),u===ue?(Rn=n,n=ve):(c=Q(),c===ue?(Rn=n,n=ve):(h=Q(),h===ue?(Rn=n,n=ve):(o=[o,r,a,s,l,d,p,u,c,h],n=o)))))))))),n!==ue&&(Ln=e,n=Lt(n)),e=n,Sn[y]={nextPos:Rn,result:e},e)}function z(){var e,n,o,r,a,s,l,d,p,u,c,h=49*Rn+36,y=Sn[h];return y?(Rn=y.nextPos,y.result):(e=Rn,n=Rn,o=Q(),o===ue?(Rn=n,n=ve):(r=Q(),r===ue?(Rn=n,n=ve):(58===t.charCodeAt(Rn)?(a=Ot,Rn++):(a=ue,0===Tn&&i(Mt)),a===ue?(Rn=n,n=ve):(s=Q(),s===ue?(Rn=n,n=ve):(l=Q(),l===ue?(Rn=n,n=ve):(58===t.charCodeAt(Rn)?(d=Ot,Rn++):(d=ue,0===Tn&&i(Mt)),d===ue?(Rn=n,n=ve):(p=Q(),p===ue?(Rn=n,n=ve):(u=Q(),u===ue?(Rn=n,n=ve):(c=U(),c===ue&&(c=je),c===ue?(Rn=n,n=ve):(o=[o,r,a,s,l,d,p,u,c],n=o))))))))),n!==ue&&(Ln=e,n=It(n)),e=n,Sn[h]={nextPos:Rn,result:e},e)}function X(){var e,n,o,r,a,s,l,d,p,u,c,h,y,v,g,x,f,b=49*Rn+37,m=Sn[b];return m?(Rn=m.nextPos,m.result):(e=Rn,n=Rn,o=Q(),o===ue?(Rn=n,n=ve):(r=Q(),r===ue?(Rn=n,n=ve):(58===t.charCodeAt(Rn)?(a=Ot,Rn++):(a=ue,0===Tn&&i(Mt)),a===ue?(Rn=n,n=ve):(s=Q(),s===ue?(Rn=n,n=ve):(l=Q(),l===ue?(Rn=n,n=ve):(58===t.charCodeAt(Rn)?(d=Ot,Rn++):(d=ue,0===Tn&&i(Mt)),d===ue?(Rn=n,n=ve):(p=Q(),p===ue?(Rn=n,n=ve):(u=Q(),u===ue?(Rn=n,n=ve):(c=U(),c===ue&&(c=je),c===ue?(Rn=n,n=ve):(45===t.charCodeAt(Rn)?(h=it,Rn++):(h=ue,0===Tn&&i(at)),h===ue&&(43===t.charCodeAt(Rn)?(h=nt,Rn++):(h=ue,0===Tn&&i(ot))),h===ue?(Rn=n,n=ve):(y=Q(),y===ue?(Rn=n,n=ve):(v=Q(),v===ue?(Rn=n,n=ve):(58===t.charCodeAt(Rn)?(g=Ot,Rn++):(g=ue,0===Tn&&i(Mt)),g===ue?(Rn=n,n=ve):(x=Q(),x===ue?(Rn=n,n=ve):(f=Q(),f===ue?(Rn=n,n=ve):(o=[o,r,a,s,l,d,p,u,c,h,y,v,g,x,f],n=o))))))))))))))),n!==ue&&(Ln=e,n=It(n)),e=n,Sn[b]={nextPos:Rn,result:e},e)}function Y(){var e,n,o,r,a,s=49*Rn+38,l=Sn[s];return l?(Rn=l.nextPos,l.result):(e=Rn,n=B(),n===ue?(Rn=e,e=ve):(84===t.charCodeAt(Rn)?(o=Vt,Rn++):(o=ue,0===Tn&&i(Tt)),o===ue?(Rn=e,e=ve):(r=z(),r===ue?(Rn=e,e=ve):(90===t.charCodeAt(Rn)?(a=St,Rn++):(a=ue,0===Tn&&i(Dt)),a===ue?(Rn=e,e=ve):(Ln=e,n=jt(n,r),e=n)))),e===ue&&(e=Rn,n=B(),n===ue?(Rn=e,e=ve):(84===t.charCodeAt(Rn)?(o=Vt,Rn++):(o=ue,0===Tn&&i(Tt)),o===ue?(Rn=e,e=ve):(r=X(),r===ue?(Rn=e,e=ve):(Ln=e,n=Nt(n,r),e=n)))),Sn[s]={nextPos:Rn,result:e},e)}function Z(){var e,n=49*Rn+39,o=Sn[n];return o?(Rn=o.nextPos,o.result):(Ft.test(t.charAt(Rn))?(e=t.charAt(Rn),Rn++):(e=ue,0===Tn&&i(Ht)),Sn[n]={nextPos:Rn,result:e},e)}function W(){var e,n,o,r=49*Rn+40,a=Sn[r];return a?(Rn=a.nextPos,a.result):(10===t.charCodeAt(Rn)?(e=$t,Rn++):(e=ue,0===Tn&&i(Ut)),e===ue&&(e=Rn,13===t.charCodeAt(Rn)?(n=Bt,Rn++):(n=ue,0===Tn&&i(zt)),n===ue?(Rn=e,e=ve):(10===t.charCodeAt(Rn)?(o=$t,Rn++):(o=ue,0===Tn&&i(Ut)),o===ue?(Rn=e,e=ve):(n=[n,o],e=n))),Sn[r]={nextPos:Rn,result:e},e)}function q(){var e,t=49*Rn+41,n=Sn[t];return n?(Rn=n.nextPos,n.result):(e=W(),e===ue&&(e=Z()),Sn[t]={nextPos:Rn,result:e},e)}function G(){var e,n,o=49*Rn+42,r=Sn[o];return r?(Rn=r.nextPos,r.result):(e=Rn,Tn++,t.length>Rn?(n=t.charAt(Rn),Rn++):(n=ue,0===Tn&&i(fe)),Tn--,n===ue?e=le:(Rn=e,e=ve),Sn[o]={nextPos:Rn,result:e},e)}function K(){var e,n=49*Rn+43,o=Sn[n];return o?(Rn=o.nextPos,o.result):(Xt.test(t.charAt(Rn))?(e=t.charAt(Rn),Rn++):(e=ue,0===Tn&&i(Yt)),Sn[n]={nextPos:Rn,result:e},e)}function Q(){var e,n,o=49*Rn+44,r=Sn[o];return r?(Rn=r.nextPos,r.result):(Zt.test(t.charAt(Rn))?(e=t.charAt(Rn),Rn++):(e=ue,0===Tn&&i(Wt)),e===ue&&(e=Rn,95===t.charCodeAt(Rn)?(n=qt,Rn++):(n=ue,0===Tn&&i(Gt)),n!==ue&&(Ln=e,n=Kt()),e=n),Sn[o]={nextPos:Rn,result:e},e)}function J(){var e,n=49*Rn+45,o=Sn[n];return o?(Rn=o.nextPos,o.result):(Qt.test(t.charAt(Rn))?(e=t.charAt(Rn),Rn++):(e=ue,0===Tn&&i(Jt)),Sn[n]={nextPos:Rn,result:e},e)}function ee(){var e,t,n,o=49*Rn+46,r=Sn[o];if(r)return Rn=r.nextPos,r.result;if(e=Rn,t=[],n=Q(),n!==ue)for(;n!==ue;)t.push(n),n=Q();else t=ve;return t!==ue&&(Ln=e,t=en(t)),e=t,Sn[o]={nextPos:Rn,result:e},e}function te(){var e,n,o=49*Rn+47,r=Sn[o];return r?(Rn=r.nextPos,r.result):(e=Rn,t.substr(Rn,2)===tn?(n=tn,Rn+=2):(n=ue,0===Tn&&i(nn)),n!==ue&&(Ln=e,n=on()),e=n,e===ue&&(e=Rn,t.substr(Rn,2)===rn?(n=rn,Rn+=2):(n=ue,0===Tn&&i(an)),n!==ue&&(Ln=e,n=sn()),e=n,e===ue&&(e=Rn,t.substr(Rn,2)===ln?(n=ln,Rn+=2):(n=ue,0===Tn&&i(dn)),n!==ue&&(Ln=e,n=pn()),e=n,e===ue&&(e=Rn,t.substr(Rn,2)===un?(n=un,Rn+=2):(n=ue,0===Tn&&i(cn)),n!==ue&&(Ln=e,n=hn()),e=n,e===ue&&(e=Rn,t.substr(Rn,2)===yn?(n=yn,Rn+=2):(n=ue,0===Tn&&i(vn)),n!==ue&&(Ln=e,n=gn()),e=n,e===ue&&(e=Rn,t.substr(Rn,2)===xn?(n=xn,Rn+=2):(n=ue,0===Tn&&i(fn)),n!==ue&&(Ln=e,n=bn()),e=n,e===ue&&(e=Rn,t.substr(Rn,2)===mn?(n=mn,Rn+=2):(n=ue,0===Tn&&i(An)),n!==ue&&(Ln=e,n=kn()),e=n,e===ue&&(e=ne()))))))),Sn[o]={nextPos:Rn,result:e},e)}function ne(){var e,n,o,r,a,s,l,d,p,u,c,h=49*Rn+48,y=Sn[h];return y?(Rn=y.nextPos,y.result):(e=Rn,t.substr(Rn,2)===wn?(n=wn,Rn+=2):(n=ue,0===Tn&&i(Cn)),n===ue?(Rn=e,e=ve):(o=Rn,r=K(),r===ue?(Rn=o,o=ve):(a=K(),a===ue?(Rn=o,o=ve):(s=K(),s===ue?(Rn=o,o=ve):(l=K(),l===ue?(Rn=o,o=ve):(d=K(),d===ue?(Rn=o,o=ve):(p=K(),p===ue?(Rn=o,o=ve):(u=K(),u===ue?(Rn=o,o=ve):(c=K(),c===ue?(Rn=o,o=ve):(r=[r,a,s,l,d,p,u,c],o=r)))))))),o===ue?(Rn=e,e=ve):(Ln=e,n=En(o),e=n)),e===ue&&(e=Rn,t.substr(Rn,2)===_n?(n=_n,Rn+=2):(n=ue,0===Tn&&i(Pn)),n===ue?(Rn=e,e=ve):(o=Rn,r=K(),r===ue?(Rn=o,o=ve):(a=K(),a===ue?(Rn=o,o=ve):(s=K(),s===ue?(Rn=o,o=ve):(l=K(),l===ue?(Rn=o,o=ve):(r=[r,a,s,l],o=r)))),o===ue?(Rn=e,e=ve):(Ln=e,n=En(o),e=n))),Sn[h]={nextPos:Rn,result:e},e)}function oe(e,t,n){var o=new Error(e);throw o.line=t,o.column=n,o}function re(e){Dn.push(e)}function ie(e,t,n,o,r){var i={type:e,value:t,line:n(),column:o()};return r&&(i.key=r),i}function ae(e,t,n){var o=parseInt('0x'+e);return!isFinite(o)||a(o)!=o||0>o||1114111<o||55295<o&&57344>o?void oe('Invalid Unicode escape code: '+e,t,n):se(o)}function se(){var e,t,n=[],o=-1,r=arguments.length;if(!r)return'';for(var i,a='';++o<r;)i=+arguments[o],65535>=i?n.push(i):(i-=65536,e=(i>>10)+55296,t=i%1024+56320,n.push(e,t)),(o+1==r||n.length>16384)&&(a+=String.fromCharCode.apply(null,n),n.length=0);return a}var le,de,pe=1<arguments.length?arguments[1]:{},ue={},ce={start:s},he=s,ye=function(){return Dn},ve=ue,ge='#',xe={type:'literal',value:'#',description:'"#"'},fe={type:'any',description:'any character'},be='[',me={type:'literal',value:'[',description:'"["'},Ae=']',ke={type:'literal',value:']',description:'"]"'},we=function(e){re(ie('ObjectPath',e,n,o))},Ce=function(e){re(ie('ArrayPath',e,n,o))},Ee=function(e,t){return e.concat(t)},_e=function(e){return[e]},Pe=function(e){return e},Re='.',Le={type:'literal',value:'.',description:'"."'},Oe='=',Me={type:'literal',value:'=',description:'"="'},Ie=function(e,t){re(ie('Assign',t,n,o,e))},Ve=function(e){return e.join('')},Te=function(e){return e.value},Se='"""',De={type:'literal',value:'"""',description:'"\\"\\"\\""'},je=null,Ne=function(e){return ie('String',e.join(''),n,o)},Fe='"',He={type:'literal',value:'"',description:'"\\""'},$e='\'\'\'',Ue={type:'literal',value:'\'\'\'',description:'"\'\'\'"'},Be='\'',ze={type:'literal',value:'\'',description:'"\'"'},Xe=function(e){return e},Ye=function(e){return e},Ze='\\',We={type:'literal',value:'\\',description:'"\\\\"'},qe=function(){return''},Ge='e',Ke={type:'literal',value:'e',description:'"e"'},Qe='E',Je={type:'literal',value:'E',description:'"E"'},et=function(e,t){return ie('Float',parseFloat(e+'e'+t),n,o)},tt=function(e){return ie('Float',parseFloat(e),n,o)},nt='+',ot={type:'literal',value:'+',description:'"+"'},rt=function(e){return e.join('')},it='-',at={type:'literal',value:'-',description:'"-"'},st=function(e){return'-'+e.join('')},lt=function(e){return ie('Integer',parseInt(e,10),n,o)},dt='true',pt={type:'literal',value:'true',description:'"true"'},ut=function(){return ie('Boolean',!0,n,o)},ct='false',ht={type:'literal',value:'false',description:'"false"'},yt=function(){return ie('Boolean',!1,n,o)},vt=function(){return ie('Array',[],n,o)},gt=function(e){return ie('Array',e?[e]:[],n,o)},xt=function(e){return ie('Array',e,n,o)},ft=function(e,t){return ie('Array',e.concat(t),n,o)},bt=function(e){return e},mt=',',At={type:'literal',value:',',description:'","'},kt='{',wt={type:'literal',value:'{',description:'"{"'},Ct='}',Et={type:'literal',value:'}',description:'"}"'},_t=function(e){return ie('InlineTable',e,n,o)},Pt=function(e,t){return ie('InlineTableValue',t,n,o,e)},Rt=function(e){return'.'+e},Lt=function(e){return e.join('')},Ot=':',Mt={type:'literal',value:':',description:'":"'},It=function(e){return e.join('')},Vt='T',Tt={type:'literal',value:'T',description:'"T"'},St='Z',Dt={type:'literal',value:'Z',description:'"Z"'},jt=function(e,t){return ie('Date',new Date(e+'T'+t+'Z'),n,o)},Nt=function(e,t){return ie('Date',new Date(e+'T'+t),n,o)},Ft=/^[ \t]/,Ht={type:'class',value:'[ \\t]',description:'[ \\t]'},$t='\n',Ut={type:'literal',value:'\n',description:'"\\n"'},Bt='\r',zt={type:'literal',value:'\r',description:'"\\r"'},Xt=/^[0-9a-f]/i,Yt={type:'class',value:'[0-9a-f]i',description:'[0-9a-f]i'},Zt=/^[0-9]/,Wt={type:'class',value:'[0-9]',description:'[0-9]'},qt='_',Gt={type:'literal',value:'_',description:'"_"'},Kt=function(){return''},Qt=/^[A-Za-z0-9_\-]/,Jt={type:'class',value:'[A-Za-z0-9_\\-]',description:'[A-Za-z0-9_\\-]'},en=function(e){return e.join('')},tn='\\"',nn={type:'literal',value:'\\"',description:'"\\\\\\""'},on=function(){return'"'},rn='\\\\',an={type:'literal',value:'\\\\',description:'"\\\\\\\\"'},sn=function(){return'\\'},ln='\\b',dn={type:'literal',value:'\\b',description:'"\\\\b"'},pn=function(){return'\b'},un='\\t',cn={type:'literal',value:'\\t',description:'"\\\\t"'},hn=function(){return'\t'},yn='\\n',vn={type:'literal',value:'\\n',description:'"\\\\n"'},gn=function(){return'\n'},xn='\\f',fn={type:'literal',value:'\\f',description:'"\\\\f"'},bn=function(){return'\f'},mn='\\r',An={type:'literal',value:'\\r',description:'"\\\\r"'},kn=function(){return'\r'},wn='\\U',Cn={type:'literal',value:'\\U',description:'"\\\\U"'},En=function(e){return ae(e.join(''))},_n='\\u',Pn={type:'literal',value:'\\u',description:'"\\\\u"'},Rn=0,Ln=0,On=0,Mn={line:1,column:1,seenCR:!1},In=0,Vn=[],Tn=0,Sn={};if('startRule'in pe){if(!(pe.startRule in ce))throw new Error('Can\'t start parsing from rule "'+pe.startRule+'".');he=ce[pe.startRule]}var Dn=[];if(de=he(),de!==ue&&Rn===t.length)return de;throw de!==ue&&Rn<t.length&&i({type:'end',description:'end of input'}),function(n,o,i){var a=r(i),s=i<t.length?t.charAt(i):null;return null!==o&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(o),new e(null===n?function(e,t){var n,o,r,i=Array(e.length);for(r=0;r<e.length;r++)i[r]=e[r].description;return n=1<e.length?i.slice(0,-1).join(', ')+' or '+i[e.length-1]:i[0],o=t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\x08/g,'\\b').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\f/g,'\\f').replace(/\r/g,'\\r').replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return'\\x0'+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return'\\x'+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return'\\u0'+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return'\\u'+t(e)})}(t)+'"':'end of input','Expected '+n+' but '+o+' found.'}(o,s):n,o,s,i,a.line,a.column)}(null,Vn,In)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:t}}()},function(e){'use strict';e.exports={compile:function(e){function t(e,t,n){var o=new Error(e);throw o.line=t,o.column=n,o}function n(e){var n,i=e.key,a=e.value,s=e.line,l=e.column;n=h?h+'.'+i:i,'undefined'!=typeof v[i]&&t('Cannot redefine existing key \''+n+'\'.',s,l),v[i]=r(a),o(n)||(u.push(n),c.push(n))}function o(e){return-1!==u.indexOf(e)}function r(e){return'Array'===e.type?d(e.value):'InlineTable'===e.type?a(e.value):e.value}function a(e){for(var t,n={},o=0;o<e.length;o++)t=e[o],'InlineTable'===t.value.type?n[t.key]=a(t.value.value):'InlineTableValue'===t.type&&(n[t.key]=r(t.value));return n}function s(e){var n=e.value,r=n.map(p).join('.'),a=e.line,s=e.column;o(r)&&t('Cannot redefine existing key \''+n+'\'.',a,s),u.push(r),v=i(y,n,{},a,s),h=n}function l(e){var n=e.value,r=n.map(p).join('.'),a=e.line,s=e.column;if(o(r)||u.push(r),u=u.filter(function(e){return 0!==e.indexOf(r)}),u.push(r),v=i(y,n,[],a,s),h=r,v instanceof Array){var l={};v.push(l),v=l}else t('Cannot redefine existing key \''+n+'\'.',a,s)}function i(e,n,o,r,a){var s,l=[],d='',p=n.join('.'),u=e,h=n.length;for(var y in n)s=n[y],l.push(s),d=l.join('.'),'undefined'==typeof u[s]?y===h-1+''?u[s]=o:u[s]={}:y!==h-1&&-1<c.indexOf(d)&&t('Cannot redefine existing key \''+d+'\'.',r,a),u=u[s],u instanceof Array&&u.length&&y<n.length-1&&(u=u[u.length-1]);return u}function d(e){var n=null;for(var o in e){var i=e[o];null===n?n=i.type:('Integer'===i.type||'Float'===i.type)&&('Integer'===n||'Float'===n)||i.type!==n&&t('Cannot add value of type '+i.type+' to array of type '+n+'.',i.line,i.column)}return e.map(r)}function p(e){return-1<e.indexOf('.')?'"'+e+'"':e}var u=[],c=[],h='',y={},v=y;return function(e){var t;for(var o in e)switch(t=e[o],t.type){case'Assign':n(t);break;case'ObjectPath':s(t);break;case'ArrayPath':l(t);}return y}(e)}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){'use strict';var o=n(4),r=n(49),i=n(1),a=n(56);class s extends r.a{constructor(){super(),this.uuid=null,this.type='span',this.rectangles=[],this.text=null,this.color=null,this.readOnly=!1,this.selectedText=null,this.textRange=null,this.page=null,this.knob=!0,this.border=!0,this.$element=this.createDummyElement(),window.globalEvent.on('deleteSelectedAnnotation',this.deleteSelectedAnnotation),window.globalEvent.on('enableViewMode',this.enableViewMode)}static newInstance(e){let t=new s;t.uuid=e.uuid||o.a(),t.text=e.text,t.color=e.color,t.readOnly=e.readOnly||!1,t.selectedText=e.selectedText,t.textRange=e.textRange,t.page=e.page,t.zIndex=e.zIndex||10,t.knob='boolean'!=typeof e.knob||e.knob,t.border=!1!==e.border;let n=window.findTexts(t.page,t.textRange[0],t.textRange[1]);return n=window.mergeRects(n),t.rectangles=n,t}static newInstanceFromTomlObject(e){let t=e;t.selectedText=t.text,t.text=t.label,t.textRange=t.textrange;let n=s.newInstance(t);return n}render(){if(!this.rectangles||0===this.rectangles.length){if(!this.page||!this.textRange)return console.log('ERROR: span missing page or textRange. span=',this);let e=window.findTexts(this.page,this.textRange[0],this.textRange[1]);e=window.mergeRects(e),this.rectangles=e}return super.render()}setHoverEvent(){this.$element.find('.anno-knob').hover(this.handleHoverInEvent,this.handleHoverOutEvent)}destroy(){let e=super.destroy();return this.emit('delete'),window.globalEvent.removeListener('deleteSelectedAnnotation',this.deleteSelectedAnnotation),window.globalEvent.removeListener('enableViewMode',this.enableViewMode),e}createAnnotation(){return{uuid:this.uuid,type:this.type,rectangles:this.rectangles,text:this.text,color:this.color,readyOnly:this.readOnly,selectedText:this.selectedText}}getTextPosition(){let e=null;return 0<this.rectangles.length&&(e={x:this.rectangles[0].x+7,y:this.rectangles[0].y-20}),e}deleteSelectedAnnotation(){super.deleteSelectedAnnotation()}handleTextSelected(){this.select()}handleTextDeselected(){this.deselect()}handleTextHoverIn(){this.highlight(),this.emit('hoverin')}handleTextHoverOut(){this.dehighlight(),this.emit('hoverout')}handleTextChanged(e){this.text=e,this.save()}handleHoverInEvent(t){super.handleHoverInEvent(t),this.emit('circlehoverin',this)}handleHoverOutEvent(t){super.handleHoverOutEvent(t),this.emit('circlehoverout',this)}handleClickEvent(t){super.handleClickEvent(t)}export(){let e=(this.selectedText||'').replace(/\r\n/g,' ').replace(/\r/g,' ').replace(/\n/g,' ').replace(/"/g,'').replace(/\\/g,'');return{type:this.type,page:this.page,label:this.text||'',text:e,textrange:this.textRange}}enableViewMode(){this.disableViewMode(),super.enableViewMode(),this.readOnly||this.$element.find('.anno-knob').on('click',this.handleClickEvent)}disableViewMode(){super.disableViewMode(),this.$element.find('.anno-knob').off('click')}}t.a=s},function(e,t,n){'use strict';var o=n(54),r=n.n(o),i=n(56),a=n(61);class s extends r.a{static isAnnotation(e){return e&&e.uuid&&e.type}constructor(){super(),this.autoBind(),this.deleted=!1,this.selected=!1,this.selectedTime=null,this.createdAt=new Date().getTime()}autoBind(){Object.getOwnPropertyNames(this.constructor.prototype).filter((e)=>'function'==typeof this[e]).forEach((e)=>{this[e]=this[e].bind(this)})}render(){if(this.$element.remove(),this.deleted)return!1;const e=$('#annoLayer2')[0];return this.$element=$(i.a(e,this)),!this.hoverEventDisable&&this.setHoverEvent&&this.setHoverEvent(),this.selected&&this.$element.addClass('--selected'),this.disabled&&this.disable(),!0}save(){window.annotationContainer.add(this)}destroy(){this.deleted=!0,this.$element.remove();let e=Promise.resolve();return this.uuid&&window.annotationContainer.remove(this),e}isHit(){return!1}handleClickEvent(){if(this.toggleSelect(),'textbox'!==this.type)if(this.selected){let e=document.createEvent('CustomEvent');e.initCustomEvent('annotationSelected',!0,!0,this),window.dispatchEvent(e)}else{let e=document.createEvent('CustomEvent');e.initCustomEvent('annotationDeselected',!0,!0,this),window.dispatchEvent(e)}}handleHoverInEvent(){console.log('handleHoverInEvent'),this.highlight(),this.emit('hoverin'),a.a('annotationHoverIn',this)}handleHoverOutEvent(){console.log('handleHoverOutEvent'),this.dehighlight(),this.emit('hoverout'),a.a('annotationHoverOut',this)}highlight(){this.$element.addClass('--hover')}dehighlight(){this.$element.removeClass('--hover')}select(){this.selected=!0,this.selectedTime=Date.now(),this.$element.addClass('--selected')}deselect(){console.log('deselect'),this.selected=!1,this.selectedTime=null,this.$element.removeClass('--selected')}toggleSelect(){this.selected?this.deselect():this.select()}deleteSelectedAnnotation(){return!!this.isSelected()&&(this.destroy().then(()=>{a.a('annotationDeleted',{uuid:this.uuid})}),!0)}isSelected(){return this.$element.hasClass('--selected')}createDummyElement(){return $('<div class="dummy"/>')}getBoundingCirclePosition(){const e=this.$element.find('.anno-knob');return 0<e.length?{x:parseFloat(e.css('left'))+parseFloat(e.css('width'))/2,y:parseFloat(e.css('top'))+parseFloat(e.css('height'))/2}:null}enableViewMode(){this.render()}disableViewMode(){this.render()}setDisableHoverEvent(){this.hoverEventDisable=!0}setEnableHoverEvent(){this.hoverEventDisable=!1}enable(){this.disabled=!1,this.$element.css('pointer-events','auto')}disable(){this.disabled=!0,this.$element.css('pointer-events','none')}equalTo(){return!1}}t.a=s},function(e,t){'use strict';function n(e,t,n){for(const o=$('.anno-knob');;){let r=!0;if(o.each(function(){var o=Math.pow;const i=$(this),a=parseInt(i.css('left')),s=parseInt(i.css('top')),l=o(e-a,2)+o(t-s,2),d=o(n,2);l<d&&(r=!1)}),r)break;t-=1}return[e,t]}t.b=function({x:e,y:t,readOnly:r}){[e,t]=n(e,t-(o+2),o);let i='anno-knob';return r&&(i+=' is-readonly'),$(`<div class="${i}"/>`).css({top:`${t}px`,left:`${e}px`,width:o+'px',height:o+'px'})};const o=7;t.a=o},function(e,t,n){'use strict';var o=n(4),r=n(49),i=n(60),a=n(3);let s;class l extends r.a{constructor(){super(),s=window.globalEvent,this.uuid=o.a(),this.type='relation',this.direction=null,this.rel1Annotation=null,this.rel2Annotation=null,this.text=null,this.color=null,this.readOnly=!1,this.$element=this.createDummyElement(),this.x1=0,this.y1=0,this.x2=0,this.y2=0,s.on('deleteSelectedAnnotation',this.deleteSelectedAnnotation),s.on('enableViewMode',this.enableViewMode),s.on('rectmoveend',this.handleRelMoveEnd)}static newInstance(e){let t=new l;return t.uuid=e.uuid||o.a(),t.direction=e.direction,t.rel1Annotation=r.a.isAnnotation(e.rel1)?e.rel1:window.annotationContainer.findById(e.rel1),t.rel2Annotation=r.a.isAnnotation(e.rel2)?e.rel2:window.annotationContainer.findById(e.rel2),t.text=e.text,t.color=e.color,t.readOnly=e.readOnly||!1,t.zIndex=e.zIndex||10,t}static newInstanceFromTomlObject(e){e.direction=e.dir,e.text=e.label;let t=l.newInstance(e);return t}setHoverEvent(){this.$element.find('path').hover(this.handleHoverInEvent,this.handleHoverOutEvent)}set rel1Annotation(e){this._rel1Annotation=e,this._rel1Annotation&&(this._rel1Annotation.on('hoverin',this.handleRelHoverIn),this._rel1Annotation.on('hoverout',this.handleRelHoverOut),this._rel1Annotation.on('rectmove',this.handleRelMove),this._rel1Annotation.on('delete',this.handleRelDelete))}get rel1Annotation(){return this._rel1Annotation}set rel2Annotation(e){this._rel2Annotation=e,this._rel2Annotation&&(this._rel2Annotation.on('hoverin',this.handleRelHoverIn),this._rel2Annotation.on('hoverout',this.handleRelHoverOut),this._rel2Annotation.on('rectmove',this.handleRelMove),this._rel2Annotation.on('delete',this.handleRelDelete))}get rel2Annotation(){return this._rel2Annotation}render(){this.setStartEndPosition(),super.render()}createAnnotation(){return{uuid:this.uuid,type:this.type,direction:this.direction,rel1:this._rel1Annotation.uuid,rel2:this._rel2Annotation.uuid,text:this.text,color:this.color,readOnly:this.readOnly}}destroy(){let e=super.destroy();return this._rel1Annotation&&(this._rel1Annotation.removeListener('hoverin',this.handleRelHoverIn),this._rel1Annotation.removeListener('hoverout',this.handleRelHoverOut),this._rel1Annotation.removeListener('rectmove',this.handleRelMove),this._rel1Annotation.removeListener('delete',this.handleRelDelete),delete this._rel1Annotation),this._rel2Annotation&&(this._rel2Annotation.removeListener('hoverin',this.handleRelHoverIn),this._rel2Annotation.removeListener('hoverout',this.handleRelHoverOut),this._rel2Annotation.removeListener('rectmove',this.handleRelMove),this._rel2Annotation.removeListener('delete',this.handleRelDelete),delete this._rel2Annotation),s.removeListener('deleteSelectedAnnotation',this.deleteSelectedAnnotation),s.removeListener('enableViewMode',this.enableViewMode),s.removeListener('rectmoveend',this.handleRelMoveEnd),e}deleteSelectedAnnotation(){super.deleteSelectedAnnotation()}getTextPosition(){return this.setStartEndPosition(),i.b(this.x1,this.y1,this.x2,this.y2,this.text,this.uuid)}highlightRelAnnotations(){this._rel1Annotation&&this._rel1Annotation.highlight(),this._rel2Annotation&&this._rel2Annotation.highlight()}dehighlightRelAnnotations(){this._rel1Annotation&&this._rel1Annotation.dehighlight(),this.rel2Annotation&&this.rel2Annotation.dehighlight()}handleTextSelected(){this.select()}handleTextDeselected(){this.deselect()}handleTextHoverIn(){this.highlight(),this.emit('hoverin'),this.highlightRelAnnotations()}handleTextHoverOut(){this.dehighlight(),this.emit('hoverout'),this.dehighlightRelAnnotations()}handleRelHoverIn(){this.highlight(),this.highlightRelAnnotations()}handleRelHoverOut(){this.dehighlight(),this.dehighlightRelAnnotations()}handleRelDelete(){this.destroy()}handleRelMove(){this.render()}handleRelMoveEnd(e){(this._rel1Annotation===e||this._rel2Annotation===e)&&this.enableViewMode()}handleTextChanged(e){this.text=e,this.save()}handleHoverInEvent(t){super.handleHoverInEvent(t),this.highlightRelAnnotations()}handleHoverOutEvent(t){super.handleHoverOutEvent(t),this.dehighlightRelAnnotations()}handleClickEvent(t){super.handleClickEvent(t)}export(){return{type:this.type,dir:this.direction,ids:[this.rel1Annotation.exportId,this.rel2Annotation.exportId],label:this.text||''}}enableViewMode(){this.disableViewMode(),super.enableViewMode(),this.readOnly||this.$element.find('path').on('click',this.handleClickEvent)}disableViewMode(){super.disableViewMode(),this.$element.find('path').off('click')}setStartEndPosition(){if(this._rel1Annotation){let e=this._rel1Annotation.getBoundingCirclePosition();this.x1=e.x,this.y1=e.y}if(this._rel2Annotation){let e=this._rel2Annotation.getBoundingCirclePosition();this.x2=e.x,this.y2=e.y}}equalTo(e){if(!e||this.type!==e)return!1;const t=a.a(this.rel1Annotation.uuid,[e.rel1Annotation.uuid,e.rel2Annotation.uuid])&&a.a(this.rel2Annotation.uuid,[e.rel1Annotation.uuid,e.rel2Annotation.uuid]);return t}}t.a=l},,,function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return'function'==typeof e}function o(e){return'number'==typeof e}function r(e){return'object'==typeof e&&null!==e}function a(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError('n must be a positive number');return this._maxListeners=e,this},t.prototype.emit=function(e){var t,o,s,l,d,i;if(this._events||(this._events={}),'error'===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length))if(t=arguments[1],t instanceof Error)throw t;else{var p=new Error('Uncaught, unspecified "error" event. ('+t+')');throw p.context=t,p}if(o=this._events[e],a(o))return!1;if(n(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:l=Array.prototype.slice.call(arguments,1),o.apply(this,l);}else if(r(o))for(l=Array.prototype.slice.call(arguments,1),i=o.slice(),s=i.length,d=0;d<s;d++)i[d].apply(this,l);return!0},t.prototype.addListener=function(e,o){var i;if(!n(o))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',e,n(o.listener)?o.listener:o),this._events[e]?r(this._events[e])?this._events[e].push(o):this._events[e]=[this._events[e],o]:this._events[e]=o,r(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,i&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[e].length),'function'==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function o(){this.removeListener(e,o),r||(r=!0,t.apply(this,arguments))}if(!n(t))throw TypeError('listener must be a function');var r=!1;return o.listener=t,this.on(e,o),this},t.prototype.removeListener=function(e,t){var o,a,s,l;if(!n(t))throw TypeError('listener must be a function');if(!this._events||!this._events[e])return this;if(o=this._events[e],s=o.length,a=-1,o===t||n(o.listener)&&o.listener===t)delete this._events[e],this._events.removeListener&&this.emit('removeListener',e,t);else if(r(o)){for(l=s;0<l--;)if(o[l]===t||o[l].listener&&o[l].listener===t){a=l;break}if(0>a)return this;1===o.length?(o.length=0,delete this._events[e]):o.splice(a,1),this._events.removeListener&&this.emit('removeListener',e,t)}return this},t.prototype.removeAllListeners=function(e){var t,o;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)'removeListener'!==t&&this.removeAllListeners(t);return this.removeAllListeners('removeListener'),this._events={},this}if(o=this._events[e],n(o))this.removeListener(e,o);else if(o)for(;o.length;)this.removeListener(e,o[o.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){'use strict';t.c=function(e){2===arguments.length&&(e=arguments[1]);let t={};const n=window.PDFView.pdfViewer.getPageView(0).viewport;return Object.keys(e).forEach((o)=>{t[o]=e[o]/n.scale}),t},t.a=function(){$('body').addClass('disable-text-layer')},t.b=function(){$('body').removeClass('disable-text-layer')}},function(e,t,n){'use strict';function o(e,t){return e.style.transform=`scale(${t.scale})`,e}t.a=function(e,t,n){n||(n=window.PDFView.pdfViewer.getPageView(0).viewport);let l;switch(t.type){case'rect':l=r.a(t,e);break;case'span':l=i.a(t,e);break;case'textbox':l=a.a(t,e);break;case'relation':l=s.a(t,e);}if(l){let r=o(l,n);'textbox'===t.type?e.appendChild(r):e.append(r)}return l};var r=n(76),i=n(77),a=n(79),s=n(80)},function(e,t){'use strict';t.a=function(e,t=1){let n=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i),o=null;return n&&(o=n.slice(1,4).map(function(e){return parseInt(e,16)})),n=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i),n&&(o=n.slice(1,4).map(function(e){return 17*parseInt(e,16)})),o?`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${t})`:e}},function(e,t,n){'use strict';n.d(t,'a',function(){return r}),n.d(t,'b',function(){return i});let o=n(78),r=o.version,i=o.pdfextract.version},function(e,t){'use strict';t.a=function(e,t){Object.keys(t).forEach((n)=>{e.setAttribute(r(n),t[n])})};const n=/[A-Z]/g,o=['viewBox'];let r=(e)=>(-1===o.indexOf(e)&&(e=e.replace(n,(e)=>'-'+e.toLowerCase())),e)},function(e,i){'use strict';function a(e,i,a,s){const l=30;if(e===a)return{x:e,y:(i+s)/2};if(i===s)return{x:(e+a)/2,y:i-l};let d={x:(e+a)/2,y:(i+s)/2},p=(i-s)/(e-a);p=-1/p;let u=r(p),c=o(u)*l,h=n(u)*l;return e<a?i>s?{x:d.x-t(c),y:d.y-t(h)}:{x:d.x+t(c),y:d.y-t(h)}:i>s?{x:d.x+t(c),y:d.y-t(h)}:{x:d.x-t(c),y:d.y-t(h)}}i.a=a,i.b=function(e,t,n,o,r='',i=null){let s=[];$('.anno-text').each(function(){let e=$(this);e.parent().data('parent-id')!==i&&s.push({x:parseFloat(e.attr('x')),y:parseFloat(e.attr('y')),width:parseFloat(e.attr('width')),height:parseFloat(e.attr('height'))})});let l=5;for(t<o&&(l*=-1);;){let r=a(e,t,n,o),d=n+.4*(r.x-n),p=o+.4*(r.y-o),i=!0;for(let e=0;e<s.length;e++){let t=s[e],n=t.x,o=t.x+t.width,r=t.y,a=t.y+t.height;if(n<=d+200&&d<=o&&r<=p+15&&p<=a){i=!1;break}}if(i)return{x:d,y:p};t+=l,o+=l}}},function(e,t){'use strict';t.a=function(e,t){var n=document.createEvent('CustomEvent');n.initCustomEvent(e,!0,!0,t),window.dispatchEvent(n)}},function(e,t){'use strict';t.a=function({uuid:e,text:t,disable:n=!1,autoFocus:o=!1,blurListener:r=null}){var i=document.createEvent('CustomEvent');i.initCustomEvent('enableTextInput',!0,!0,...arguments),window.dispatchEvent(i),console.log('dispatchEvent:',i,arguments[0])}},function(e,t,n){'use strict';var o=n(4),r=n(49),i=n(55),a=n(1);let s;class l extends r.a{constructor(){super(),s=window.globalEvent,this.uuid=null,this.type='rect',this.x=0,this.y=0,this.width=0,this.height=0,this.text=null,this.color=null,this.readOnly=!1,this.$element=this.createDummyElement(),s.on('deleteSelectedAnnotation',this.deleteSelectedAnnotation),s.on('enableViewMode',this.enableViewMode)}static newInstance(e){let t=new l;return t.uuid=e.uuid||o.a(),t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t.text=e.text,t.color=e.color,t.readOnly=e.readOnly||!1,t.zIndex=e.zIndex||10,t}static newInstanceFromTomlObject(e){let t=e;t.position=t.position.map(parseFloat),t.x=t.position[0],t.y=a.a(t.page,t.position[1]),t.width=t.position[2],t.height=t.position[3],t.text=t.label;let n=l.newInstance(t);return n}setHoverEvent(){this.$element.find('.anno-rect, .anno-knob').hover(this.handleHoverInEvent,this.handleHoverOutEvent)}destroy(){let e=super.destroy();return this.emit('delete'),window.globalEvent.removeListener('deleteSelectedAnnotation',this.deleteSelectedAnnotation),window.globalEvent.removeListener('enableViewMode',this.enableViewMode),e}createAnnotation(){return{uuid:this.uuid,type:this.type,x:this.x,y:this.y,width:this.width,height:this.height,text:this.text,color:this.color,readyOnly:this.readOnly}}deleteSelectedAnnotation(){super.deleteSelectedAnnotation()}getTextPosition(){return{x:this.x+7,y:this.y-20}}handleTextSelected(){this.select()}handleTextDeselected(){this.deselect()}handleTextHoverIn(){this.highlight(),this.emit('hoverin')}handleTextHoverOut(){this.dehighlight(),this.emit('hoverout')}handleTextChanged(e){console.log('rect:handleTextChanged:',e),this.text=e,this.save()}handleHoverInEvent(t){super.handleHoverInEvent(t);let e=$(t.currentTarget);'circle'===e.prop('tagName')&&this.emit('circlehoverin',this)}handleHoverOutEvent(t){super.handleHoverOutEvent(t);let e=$(t.currentTarget);'circle'===e.prop('tagName')&&this.emit('circlehoverout',this)}handleClickEvent(t){super.handleClickEvent(t)}handleMouseDownOnRect(){console.log('handleMouseDownOnRect'),this.originalX=this.x,this.originalY=this.y,document.addEventListener('mousemove',this.handleMouseMoveOnDocument),document.addEventListener('mouseup',this.handleMouseUpOnDocument),window.globalEvent.emit('rectmovestart'),i.a()}handleMouseMoveOnDocument(t){this._dragging=!0,this.startX||(this.startX=parseInt(t.clientX),this.startY=parseInt(t.clientY)),this.endX=parseInt(t.clientX),this.endY=parseInt(t.clientY);let e=i.c({x:this.endX-this.startX,y:this.endY-this.startY});this.x=this.originalX+e.x,this.y=this.originalY+e.y,this.render(),this.emit('rectmove',this)}handleMouseUpOnDocument(){this._dragging&&(this._dragging=!1,this.originalX=null,this.originalY=null,this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.save(),this.enableViewMode(),s.emit('rectmoveend',this)),document.removeEventListener('mousemove',this.handleMouseMoveOnDocument),document.removeEventListener('mouseup',this.handleMouseUpOnDocument),'rect'!==window.currentType&&i.b()}enableDragAction(){this.$element.find('.anno-rect, circle').off('mousedown',this.handleMouseDownOnRect).on('mousedown',this.handleMouseDownOnRect)}disableDragAction(){this.$element.find('.anno-rect, circle').off('mousedown',this.handleMouseDownOnRect)}enableViewMode(){super.enableViewMode(),this.readOnly||(this.$element.find('.anno-rect, .anno-knob').on('click',this.handleClickEvent),this.enableDragAction())}disableViewMode(){super.disableViewMode(),this.$element.find('.anno-rect, .anno-knob').off('click'),this.disableDragAction()}}t.a=l},,,,,,,function(e,t,n){'use strict';function o(){$('#annoLayer, #annoLayer2').remove()}function r(){if(!window.PDFView.pdfViewer.getPageView(0))return;const e='annoLayer',t='annoLayer2';if(0<$('#'+e).length)return;if(0<$('#'+t).length)return;let n=($('#viewer').width()-$('.page').width())/2;0>n&&(n=9);let o=$('#viewer').height(),r=$('.page').width(),a=$(`<svg id="${e}" class="${e}"/>`).css({position:'absolute',top:'0px',left:`${n}px`,width:`${r}px`,height:`${o}px`,visibility:'hidden',"z-index":2}),s=$(`<div id="${t}"/>`).addClass('annoLayer').css({position:'absolute',top:'0px',left:`${n}px`,width:`${r}px`,height:`${o}px`,visibility:'hidden',"z-index":2});$('#viewer').css({position:'relative'}).append(a).append(s),i()}function i(){const e=window.annotationContainer.getAllAnnotations();0===e.length||(e.forEach((e)=>{e.render(),e.enableViewMode()}),a.b('annotationrendered'))}Object.defineProperty(t,'__esModule',{value:!0});var a=n(3),s=n(54),l=n.n(s),d=n(73),p=n(83);n(71),window.globalEvent=new l.a,t['default']=d.a,window.annotationContainer=new p.a,d.a.UI.enableViewMode(),window.addEventListener('pagerendered',function(e){if(console.log('pagerendered:',e.detail.pageNumber),!!window.PDFView.pdfViewer.getPageView(0)){r();let e=window.PDFView.pdfViewer.getPageView(0).viewport.scale,t=`${9*e}px`,n=`${-9*e}px`,o=`${1*e}px`;$('.page').css({"border-top-width":t,"border-bottom-width":t,marginBottom:n,marginTop:o})}}),window.addEventListener('scalechange',()=>{console.log('scalechange'),o(),r()})},function(e,t,n){var o=n(72);'string'==typeof o&&(o=[[e.i,o,'']]);n(6)(o,{});o.locals&&(e.exports=o.locals),!1},function(e,t,n){t=e.exports=n(5)(),t.push([e.i,'@charset "utf-8";\n\n/*\n *  Search UI.\n */\n.pdfanno-search-result {\n    position: absolute;\n    background-color: rgba(0, 255, 0, 0.7)\n}\n.pdfanno-search-result--highlight {\n    background-color: rgba(255, 0, 0, 0.7)\n}\n\n/*\n * Text Layer.\n */\n.pdfanno-text-layer {\n    position: absolute;\n    text-align: center;\n}\n\n/**\n * Annotation Layer.\n */\n.annoLayer > * {\n  opacity: 0.5;\n}\n.annoLayer > *.\\--hover,\n.annoLayer > *.\\--selected {\n  opacity: 1;\n}\n\n/**\n    Annotation Knob for control.\n*/\n.anno-knob {\n    position: absolute;\n    background-color: blue;\n    border-radius: 50%;\n    transition: 0.2s;\n    transform-origin: center center;\n}\n.\\--hover .anno-knob,\n.\\--selected .anno-knob {\n  box-shadow: rgba(113,135,164,.2) 1px 1px 1px;\n  transform: scale(2);\n}\n.anno-knob.is-readonly {\n    border-radius: 0;\n    transform: rotate(45deg) scale(0.7);\n}\n.\\--hover .anno-knob.is-readonly,\n.\\--selected .anno-knob.is-readonly {\n  transform: rotate(45deg) scale(1.4);\n}\n\n/*\n * Span Annotation.\n */\n.anno-span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    visibility: visible;\n}\n.anno-span__area {\n    position: absolute;\n    border: 1px solid black;\n}\n.\\--hover .anno-span__area,\n.\\--selected .anno-span__area {\n  border: 1px dashed black !important;\n  box-sizing: border-box;\n}\n.anno-span__area.no-border,\n.\\--hover .anno-span__area.no-border,\n.\\--selected .anno-span__area.no-border {\n  border-width: 0;\n}\n.anno-span__border {\n  position: absolute;\n  /*\n  #135 Change the style of Reference Anno\n  border-bottom-width: 1px;\n  border-bottom-style: solid;\n  */\n  border: 1px solid black;\n}\n\n/*TODO Relation\u3092\u63CF\u753B\u3057\u305F\u76F4\u5F8C\u306F\u3001\u4F4D\u7F6E\u304C\u5C11\u3057\u305A\u308C\u308B\u3002\u305D\u306E\u5F8C\u306B\u30D5\u30A9\u30FC\u30AB\u30B9\u304C\u5916\u308C\u308B\u3068\u6B63\u3057\u3044\u4F4D\u7F6E\u3078\u79FB\u52D5\u3059\u308B\u3002*/\n\n/**\n  Relation Annotation.\n*/\n.\\--hover .anno-relation,\n.\\--selected .anno-relation {\n  stroke-width: 2px;\n}\n.anno-relation-outline {\n  fill: none;\n  visibility: hidden;\n}\n.\\--selected .anno-relation-outline {\n  visibility: visible;\n  stroke: black;\n  stroke-width: 3px;\n  pointer-events: stroke;\n  stroke-dasharray: 5;\n}\n\n/**\n * Span Annotation.\n */\n.anno-span rect {\n    /* Enable the hover event on circles and text even if they are overwraped other spans. */\n    pointer-events: none;\n}\n\n/**\n  Rect Annotation.\n*/\n.anno-rect-base {\n    position: absolute;\n    top: 0;\n    left: 0;\n    visibility: visible;\n}\n.anno-rect {\n    position: absolute;\n}\n.\\--hover .anno-rect {\n  box-shadow: 0 0 0 1px #ccc inset;\n  stroke: #ccc;\n  stroke-width: 0.75px;\n}\n.\\--selected .anno-rect {\n  stroke: black;\n  stroke-width: 0.5px;\n  stroke-dasharray: 3;\n}\n\n/**\n Disable text layers.\n*/\nbody.disable-text-layer .textLayer {\n    display: none;\n}\n',''])},function(e,t,n){'use strict';var o=n(74),r=n(63),i=n(48),a=n(51);t.a={UI:o.a,RectAnnotation:r.a,SpanAnnotation:i.a,RelationAnnotation:a.a}},function(e,t,n){'use strict';var o=n(75),r=n(81),i=n(82);t.a={createSpan:o.a,getRectangles:o.b,createRelation:r.a,enableViewMode:i.a}},function(t,n,o){'use strict';function r(){return window.PDFView.pdfViewer.getPageView(0).viewport.scale}function i(t){var n=Math.max;t=t.filter((e)=>e),t=t.map((e)=>(e.top=e.top||e.y,e.left=e.left||e.x,e.right=e.right||e.x+e.w,e.bottom=e.bottom||e.y+e.h,e));const o=5*r();let l=a(t[0]),d=[l];for(let r=1;r<t.length;r++)s(t[r].top,l.top,o)?(l.top=e(l.top,t[r].top),l.left=e(l.left,t[r].left),l.right=n(l.right,t[r].right),l.bottom=n(l.bottom,t[r].bottom),l.x=l.left,l.y=l.top,l.width=l.right-l.left,l.height=l.bottom-l.top):(l=a(t[r]),d.push(l));return d}function a(e){return{top:e.top,left:e.left,right:e.right,bottom:e.bottom,x:e.x,y:e.y,width:e.width,height:e.height}}function s(e,t,n){return t-n<=e&&e<=t+n}function l({text:e='',rects:t=[],textRange:n=[],selectedText:o='',zIndex:r=10,color:i='#ffff00',page:a=1,save:s=!0,focusToLabel:l=!0,knob:d=!0,border:p=!0}){if(t){let u=c.a.newInstance({rectangles:t,selectedText:o,text:e,textRange:n,zIndex:r,color:i,page:a,knob:d,border:p});return s&&u.save(),u.render(),u.select(),l&&h.a({uuid:u.uuid,autoFocus:!0,text:e}),u}}function d(){if(!b||!g||!f)return null;else{let e=findTexts(b,g,f);return i(e)}}function p({text:e=null,zIndex:t=10,color:n=null}){if(!b||!g||!f)return null;else{let o=findTexts(b,g,f);if(0===o.length)return null;let r=o.map((e)=>e?e.char:' ').join('');const a=i(o),s=l({rects:a,page:b,text:e,zIndex:t,color:n,textRange:[g,f],selectedText:r});return x&&x.destroy(),g=null,f=null,b=null,x=null,s}}n.b=d,n.a=p;var u=o(55),c=o(48),h=o(62);window.addEventListener('DOMContentLoaded',()=>{function t(t){const e=t.currentTarget,n=e.parentNode,o=parseInt(n.getAttribute('data-page-number'));b=o;const{top:r,left:i}=e.getBoundingClientRect(),a=t.clientX-i,s=t.clientY-r,l=window.findText(o,u.c({x:a,y:s}));l&&(g&&f?l.position<v?(g=l.position,f=v):(g=v,f=l.position):(v=l.position,g=l.position,f=l.position))}function n(n){t(n),x&&(x.destroy(),x=null);let e=findTexts(b,g,f);if(0<e.length){const t=i(e);x=l({rects:t,page:b,save:!1,focusToLabel:!1,color:'#0f0',knob:!1,border:!1,textRange:[g,f]}),x.disable()}}const e=$('#viewer');e.on('mousedown','.canvasWrapper',(t)=>{o||(y=!0,b=null,v=null,g=null,f=null,x&&(x.destroy(),x=null),n(t))}),e.on('mousemove','.canvasWrapper',(t)=>{y&&n(t)}),e.on('mouseup','.canvasWrapper',(t)=>{y&&(n(t),x&&x.deselect()),y=!1});let o=!1;window.addEventListener('annotationHoverIn',()=>{o=!0}),window.addEventListener('annotationHoverOut',()=>{o=!1}),window.addEventListener('annotationDeleted',()=>{o=!1})});let y=!1,v=null,g=null,f=null,b=null,x=null},function(e,t,n){'use strict';t.a=function(e){let t=e.color||'#FF0';const n=$('<div class="anno-rect-base"/>');return n.append($('<div class="anno-rect"/>').css({top:`${e.y}px`,left:`${e.x}px`,width:`${e.width}px`,height:`${e.height}px`,border:`1px solid ${t}`,backgroundColor:e.readOnly?'none':r.a(t,.3)})),n.append(o.b(e)),n[0]};var o=n(50),r=n(57)},function(e,t,n){'use strict';function o(e,t,n,o){let r=o?'anno-span__border':'anno-span__area';return!1===e.border&&(r+=' no-border'),$(`<div class="${r}"/>`).css({top:t.y+'px',left:t.x+'px',width:t.width+'px',height:t.height+'px',backgroundColor:i.a(n,.4),borderColor:n})}t.a=function(e){const t=e.readOnly,n=e.color||'#FF0',i=$('<div class="anno-span"/>').css('zIndex',e.zIndex||10);!e.page&&0<e.rectangles.length&&(e.page=e.rectangles[0].page);let a=9;const s=window.PDFView.pdfViewer.getPageView(0),l=s.viewport,d=l.viewBox;let p=d[3]-d[1],u=a+(a+p+1)*(e.page-1);const c=e.rectangles.map((e)=>({x:e.x||e.left,y:(e.y||e.top)+u,width:e.width||e.right-e.left,height:e.height||e.bottom-e.top})).filter((e)=>0<e.width&&0<e.height&&-1<e.x&&-1<e.y);return c.forEach((a)=>{i.append(o(e,a,n,t))}),e.knob&&i.append(r.b({x:c[0].x,y:c[0].y,readOnly:t})),i[0]};var r=n(50),i=n(57),a=n(58);console.log('ANNO_VERSION:',a.a)},function(e){e.exports={name:'pdfanno',version:'0.4.1-dev',description:'',main:'index.js',scripts:{_prepare:'gulp prepare',start:'concurrently --kill-others "npm run server:dev" "npm run front:dev"',"front:sw":'gulp build-sw',"front:sw:watch":'gulp watch-sw',"front:dev":'concurrently --kill-others "npm run _prepare && npm run front:sw && webpack-dev-server --inline" "npm run front:sw:watch"',"front:publish:latest":'npm run _prepare && cross-env BUILD_TARGET=latest npm run front:sw && cross-env NODE_ENV=production SERVER_PATH=latest webpack && gulp publish_latest',"front:publish:stable":'npm run _prepare && cross-env BUILD_TARGET=stable  npm run front:sw && cross-env NODE_ENV=production SERVER_PATH=0.3.1  webpack && gulp publish_stable',"server:latest":'cross-env NODE_ENV=production NODE_PORT=1001 node server/server.js',"server:stable":'cross-env NODE_ENV=production NODE_PORT=1000 node server/server.js',"server:dev":'cross-env NODE_PORT=3000 ./node_modules/.bin/node-dev server/server.js'},repository:{type:'git',url:'git+https://github.com/paperai/pdfanno'},author:'hshindo, yoheiMune',license:'MIT',bugs:{url:'https://github.com/paperai/pdfanno/issues'},homepage:'https://github.com/paperai/pdfanno#readme',pdfextract:{version:'0.2.3',url:'https://github.com/paperai/pdfextract/releases/download/v0.2.3/pdfextract-0.2.3.jar'},devDependencies:{"babel-cli":'^6.26.0',"babel-core":'^6.26.0',"babel-eslint":'^7.2.3',"babel-helpers":'^6.24.1',"babel-loader":'6.2.4',"babel-messages":'^6.23.0',"babel-minify-webpack-plugin":'^0.3.0',"babel-plugin-add-module-exports":'^0.2.1',"babel-preset-es2015":'^6.24.1',"babel-preset-stage-1":'^6.24.1',concurrently:'^3.5.1',copy:'^0.3.0',cpr:'^2.2.0',"cross-env":'^5.0.5',"css-loader":'^0.25.0',"deep-assign":'^2.0.0',eslint:'^3.19.0',"eslint-config-standard":'^6.2.1',"eslint-friendly-formatter":'^2.0.7',"eslint-loader":'^1.7.1',"eslint-plugin-html":'^2.0.0',"eslint-plugin-promise":'^3.5.0',"eslint-plugin-standard":'^2.3.1',"file-loader":'^0.9.0',"fs-extra":'^1.0.0',"fuse.js":'^3.1.0',gulp:'^3.9.1',"gulp-clean-css":'^3.9.3',"gulp-cli":'^1.4.0',"gulp-replace":'^0.6.1',"gulp-sourcemaps":'^2.6.4',"gulp-uglify-es":'^1.0.1',"gulp-util":'^3.0.8',"node-dev":'^3.1.3',"run-sequence":'^2.2.1',"style-loader":'^0.13.2',"vinyl-source-stream":'^1.1.0',webpack:'3.0.0',"webpack-dev-server":'^1.16.5'},dependencies:{"anno-ui":'github:paperai/anno-ui#master',axios:'^0.15.2',"body-parser":'^1.17.2',express:'^4.15.4',"gulp-htmlmin":'^4.0.0',"json-loader":'^0.5.7',mkdirp:'^0.5.1',"mkdirp-promise":'^5.0.1',multer:'^1.3.0',request:'^2.81.0',"request-promise":'^4.2.2',requirejs:'^2.3.5',"socket.io":'^2.0.4',toml:'github:yoheiMune/toml-node',urijs:'^1.19.0'}}},function(e,t,n){'use strict';function o(e,t){t.appendChild(e);let n=e.getBoundingClientRect();return e.parentNode.removeChild(e),n}t.a=function(e,t){let n=document.createElementNS('http://www.w3.org/2000/svg','text');r.a(n,{x:e.x,y:e.y+parseInt(i,10),fill:e.color||'#F00',fontSize:i}),n.innerHTML=e.content||e.text;let a=document.createElementNS('http://www.w3.org/2000/svg','rect'),s=o(n,t);r.a(a,{x:e.x-1,y:e.y,width:s.width,height:s.height,fill:'#FFFFFF',class:'anno-text'});let l=document.createElementNS('http://www.w3.org/2000/svg','g');return l.classList.add('anno-text-group'),l.setAttribute('read-only',!0===e.readOnly),l.setAttribute('data-parent-id',e.parentId),l.style.visibility='visible',l.appendChild(a),l.appendChild(n),l};var r=n(59);const i=9.5},function(i,a,s){'use strict';function l(e,t,n,o){const r=50;let i=$('<svg class=""/>').css({position:'absolute',top:`${e-r}px`,left:`${t-r}px`,width:`${n+2*r}px`,height:`${o+2*r}px`,visibility:'hidden',"z-index":2}).attr({x:0,y:0});return[i,r]}a.a=function(i){i.color=i.color||'#F00';let a=r((i.y1-i.y2)/(i.x1-i.x2)),s=i.x1<i.x2?1:-1;i.x1+=p.a*o(a)*s,i.x2-=p.a*o(a)*s,i.y1+=p.a*n(a)*s,i.y2-=p.a*n(a)*s;let c=e(i.y1,i.y2),h=e(i.x1,i.x2),y=t(i.x1-i.x2),v=t(i.y1-i.y2);const[g,x]=l(c,h,y,v);i.x1=i.x1-h+x,i.x2=i.x2-h+x,i.y1=i.y1-c+x,i.y2=i.y2-c+x;let f=document.createElementNS('http://www.w3.org/2000/svg','g');d.a(f,{fill:i.color,stroke:i.color}),f.style.visibility='visible',f.setAttribute('read-only',!0===i.readOnly),g[0].appendChild(f);const b='relationhead'+i.color.replace('#','');if(!document.querySelector('#'+b)){let e=document.createElementNS('http://www.w3.org/2000/svg','marker');d.a(e,{viewBox:'0 0 10 10',fill:i.color,id:b,orient:'auto-start-reverse'}),e.setAttribute('preserveAspectRatio','none'),e.setAttribute('markerWidth',5),e.setAttribute('markerHeight',5),e.setAttribute('refX',5),e.setAttribute('refY',5),f.appendChild(e);let t=document.createElementNS('http://www.w3.org/2000/svg','polygon');d.a(t,{points:'0,0 0,10 10,5'}),e.appendChild(t)}let m=u.a(i.x1,i.y1,i.x2,i.y2),A=document.createElementNS('http://www.w3.org/2000/svg','path');d.a(A,{d:`M ${i.x1} ${i.y1} Q ${m.x} ${m.y} ${i.x2} ${i.y2}`,class:'anno-relation-outline'}),f.appendChild(A);let k=document.createElementNS('http://www.w3.org/2000/svg','path');d.a(k,{d:`M ${i.x1} ${i.y1} Q ${m.x} ${m.y} ${i.x2} ${i.y2}`,stroke:i.color,strokeWidth:1,fill:'none',class:'anno-relation'}),('one-way'===i.direction||'two-way'===i.direction)&&k.setAttribute('marker-end',`url(#${b})`),'two-way'===i.direction&&k.setAttribute('marker-start',`url(#${b})`),f.appendChild(k);const w=$('<div/>').css({position:'absolute',top:0,left:0,visibility:'visible'}).addClass('anno-relation');return w.append(g),w[0]};var d=s(59),p=s(50),u=s(60)},function(e,t,n){'use strict';t.a=function({type:e,anno1:t,anno2:n,text:i,color:a}){3===arguments.length&&(e=arguments[0],t=arguments[1],n=arguments[2]);let s=new r.a;return s.direction=e,s.rel1Annotation=t,s.rel2Annotation=n,s.text=i,s.color=a,s.save(),s.render(),window.annotationContainer.getSelectedAnnotations().forEach((e)=>e.deselect()),s.select(),o.a({uuid:s.uuid,autoFocus:!0,text:i}),s};var o=n(62),r=n(51)},function(e,t){'use strict';function n(t){return'input'===t.target.tagName.toLowerCase()?void 0:46===t.keyCode||8===t.keyCode?(t.preventDefault(),'keyup'===t.type&&r(),!1):void 0}function o(){window.annotationContainer.getSelectedAnnotations().forEach((e)=>e.deselect());var e=document.createEvent('CustomEvent');e.initCustomEvent('annotationDeselected',!0,!0,this),window.dispatchEvent(e)}function r(){window.globalEvent.emit('deleteSelectedAnnotation')}t.a=function(){console.log('view:enableViewMode'),document.removeEventListener('keyup',n),document.removeEventListener('keydown',n),document.addEventListener('keyup',n),document.addEventListener('keydown',n),$(document).off('click',o).on('click','.page',o)}},function(e,t,n){'use strict';var o=n(4),r=n(58),a=n(84),i=n(61),s=n(1),l=n(48),p=n(63),u=n(51);t.a=class{constructor(){this.set=new Set}add(e){this.set.add(e),i.a('annotationUpdated')}remove(e){this.set.delete(e),i.a('annotationUpdated')}destroy(){console.log('AnnotationContainer#destroy'),this.set.forEach((e)=>e.destroy()),this.set=new Set}getAllAnnotations(){let e=[];return this.set.forEach((t)=>e.push(t)),e}getSelectedAnnotations(){return this.getAllAnnotations().filter((e)=>e.selected)}findById(e){e+='';let t=null;return this.set.forEach((n)=>{n.uuid===e&&(t=n)}),t}changeColor({text:e,color:t,uuid:n,annoType:o}){if(console.log('changeColor: ',e,t,n),n){const e=this.findById(n);e&&(e.color=t,e.render(),e.enableViewMode())}else this.getAllAnnotations().filter((t)=>t.text===e).filter((e)=>'span'===o?e.type===o:('one-way'===o||'two-way'===o||'link'===o)&&'relation'===e.type&&e.direction===o).forEach((e)=>{e.color=t,e.render(),e.enableViewMode()})}setColor(e){console.log('setColor:',e),Object.keys(e).forEach((t)=>{'default'===t||Object.keys(e[t]).forEach((n)=>{const o=e[t][n];this.changeColor({text:n,color:o,annoType:t})})})}exportData(){return new Promise((e)=>{let t={version:r.a,"pdfextract-version":r.b};const n=this.getAllAnnotations().filter((e)=>!e.readOnly);n.sort((e,t)=>e.createdAt-t.createdAt);let o=0;n.forEach((e)=>{o++,'span'===e.type?(t[o]=e.export(),e.exportId=o):'relation'===e.type&&(t[o]=e.export())}),n.forEach((e)=>{delete e.exportId}),e(a.b(t))})}importAnnotations(e,t){function n(e,t,n){let o=i.default;return i[t]&&i[t][n]&&(o=i[t][n]),o}const r=!t,i=e.colorMap;return new Promise((t)=>{this.getAllAnnotations().filter((e)=>e.readOnly===r).forEach((e)=>e.destroy()),e.annotations.forEach((e,t)=>{let i=a.a(e);if(i)for(const e in i){let a=i[e];if('object'==typeof a)if(a.uuid=o.a(),a.readOnly=r,'span'===a.type){let e=l.a.newInstanceFromTomlObject(a);e.color=n(t,e.type,e.text),e.save(),e.render(),e.enableViewMode()}else if('rect'===a.type){let e=p.a.newInstanceFromTomlObject(a);e.color=n(t,e.type,e.text),e.save(),e.render(),e.enableViewMode()}else if('relation'===a.type){a.rel1=i[a.ids[0]].uuid,a.rel2=i[a.ids[1]].uuid;let e=u.a.newInstanceFromTomlObject(a);e.color=n(t,e.direction,e.text),e.save(),e.render(),e.enableViewMode()}else console.log('Unknown: ',e,a)}}),t(!0)})}}},function(e,t,n){'use strict';function o(e,t=!0){let n=[];if('version'in e&&(n.push(`version = "${e.version}"`),n.push(`pdfextract-version = "${e['pdfextract-version']}"`),n.push(''),delete e.version,delete e['pdfextract-version']),'position'in e){let t=e.position;t=t.map((e)=>'number'==typeof e?e+'':e.map((e)=>e+'')),e.position=t}return Object.keys(e).forEach((i)=>{let a=e[i];'string'==typeof a?(n.push(`${i} = "${a}"`),t&&n.push('')):'number'==typeof a?(n.push(`${i} = ${a}`),t&&n.push('')):r(a)?(n.push(`${i} = ${JSON.stringify(a)}`),t&&n.push('')):'object'==typeof a&&(n.push(`[${i}]`),n.push(o(a,!1)),t&&n.push(''))}),n.join('\n')}function r(e){return e&&'length'in e}t.b=o,t.a=function(t){try{return a.a.parse(t)}catch(n){return console.log('ERROR:',n),console.log('TOML:\n',t),null}};var i=n(12),a=n.n(i)}])});
//# sourceMappingURL=pdfanno.core.bundle.js.map